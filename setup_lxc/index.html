<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Setup with LXC - Docs for AnotherAURHelper</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" disabled>
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" >
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Docs for AnotherAURHelper</a>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="true">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="false">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#setting-up-anotheraurhelper-with-lxc" class="nav-link">Setting up AnotherAURHelper with LXC</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#privileged-containers" class="nav-link">Privileged Containers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#lxc-container-setup" class="nav-link">LXC Container Setup</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#creating-the-chroot" class="nav-link">Creating the CHROOT</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#set-up-gnupg-for-signature-verifcation-and-package-signing" class="nav-link">Set up GnuPG for Signature Verifcation and Package Signing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#set-up-output-dir-and-configuration" class="nav-link">Set up Output Dir and Configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#registering-the-repo-on-other-arch-systems" class="nav-link">Registering the Repo on other Arch systems</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#testing" class="nav-link">Testing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#serving-the-packages" class="nav-link">Serving the Packages</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="setting-up-anotheraurhelper-with-lxc">Setting up AnotherAURHelper with LXC</h1>
<p>It is recommended to use AnotherAURHelper with a container as a safety net due
to the fact that <code>makechrootpkg</code> directly sources/parses PKGBUILDs.</p>
<p>The following assumes you already have LXC installed. If not, <a href="https://wiki.archlinux.org/title/Linux_Containers#Setup">follow the
ArchWiki</a> until you
can get an arbitrary container up and running.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following code blocks will have different prefixes. <code>&gt;</code> is used to
specify commands run on an ArchLinux installation, and <code>$</code> is used to
specify commands run inside of the LXC container.</p>
</div>
<h2 id="privileged-containers">Privileged Containers</h2>
<p>AnotherAURHelper requires to be run in a privileged container because it uses
a chroot. If your LXC is already configured for unprivileged containers, you can
create a privileged container by commenting out the config for an unprivileged
container and creating a container, and uncommenting after the container has
been created to allow future containers to be created as unprivileged.</p>
<div class="codehilite"><pre><span></span><code># /etc/lxc/default.conf
#lxc.idmap = u 0 100000 65536
#lxc.idmap = g 0 100000 65536
</code></pre></div>

<h2 id="lxc-container-setup">LXC Container Setup</h2>
<p>Create the container like the following on your host system.</p>
<div class="codehilite"><pre><span></span><code>&gt;<span class="w"> </span>sudo<span class="w"> </span>lxc-create<span class="w"> </span>-n<span class="w"> </span>aur_helper<span class="w"> </span>-t<span class="w"> </span>download
Downloading<span class="w"> </span>the<span class="w"> </span>image<span class="w"> </span>index

---
DIST<span class="w">             </span>RELEASE<span class="w">     </span>ARCH<span class="w">   </span>VARIANT<span class="w">  </span>BUILD
---
...
archlinux<span class="w">        </span>current<span class="w">     </span>amd64<span class="w">  </span>default<span class="w">  </span>20250303_05:33
archlinux<span class="w">        </span>current<span class="w">     </span>arm64<span class="w">  </span>default<span class="w">  </span>20250303_05:49
...
---

Distribution:
&gt;<span class="w"> </span>archlinux
Release:
&gt;<span class="w"> </span>current
Architecture:
&gt;<span class="w"> </span>amd64

The<span class="w"> </span>cached<span class="w"> </span>copy<span class="w"> </span>has<span class="w"> </span>expired,<span class="w"> </span>re-downloading...
Downloading<span class="w"> </span>the<span class="w"> </span>image<span class="w"> </span>index
Downloading<span class="w"> </span>the<span class="w"> </span>rootfs
Downloading<span class="w"> </span>the<span class="w"> </span>metadata
The<span class="w"> </span>image<span class="w"> </span>cache<span class="w"> </span>is<span class="w"> </span>now<span class="w"> </span>ready
Unpacking<span class="w"> </span>the<span class="w"> </span>rootfs

---
You<span class="w"> </span>just<span class="w"> </span>created<span class="w"> </span>an<span class="w"> </span>Archlinux<span class="w">  </span>x86_64<span class="w"> </span><span class="o">(</span>20250303_05:33<span class="o">)</span><span class="w"> </span>container.
</code></pre></div>

<p>Start the container.</p>
<div class="codehilite"><pre><span></span><code><span class="k">&gt; </span><span class="ge">sudo lxc-start -n aur_helper -s lxc.apparmor.allow_nesting=1 -s lxc.apparmor.profile=generated</span>
</code></pre></div>

<p>Attach to a shell inside the container.</p>
<div class="codehilite"><pre><span></span><code><span class="k">&gt; </span><span class="ge">sudo lxc-attach -n aur_helper</span>
</code></pre></div>

<h3 id="getting-required-packages">Getting Required Packages</h3>
<p>Update your <a href="https://wiki.archlinux.org/title/Mirrors">mirror-list</a> in the
container and update.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pacman<span class="w"> </span>-Syu
</code></pre></div>

<p><code>base-devel</code>, <code>devtools</code>, and <code>python-toml</code> is required.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pacman<span class="w"> </span>-S<span class="w"> </span>base-devel<span class="w"> </span>devtools<span class="w"> </span>python-toml
</code></pre></div>

<p>You may need to grab an editor like <code>vim</code>, <code>emacs</code>, or <code>nano</code>.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pacman<span class="w"> </span>-S<span class="w"> </span>vim<span class="w"> </span>emacs<span class="w"> </span>nano
</code></pre></div>

<p>If your filesystem is using <code>btrfs</code>, you will need to install <code>btrfs-progs</code>.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pacman<span class="w"> </span>-S<span class="w"> </span>btrfs-progs
</code></pre></div>

<h3 id="setting-up-ssh-for-the-container">Setting up SSH for the Container</h3>
<p>This is pretty straightforward, but for those unfamiliar with ssh, heres a quick
setup guide.</p>
<p>First, install <code>openssh</code>.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pacman<span class="w"> </span>-S<span class="w"> </span>openssh
</code></pre></div>

<p>Enable and start sshd.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>sshd
</code></pre></div>

<p>After setting up the user in the following section, you can use ssh to log in to
the user.</p>
<p>You can fetch the local ip address of the running container with the following.</p>
<div class="codehilite"><pre><span></span><code>&gt;<span class="w"> </span>sudo<span class="w"> </span>lxc-ls<span class="w"> </span>-f
NAME<span class="w">       </span>STATE<span class="w">   </span>AUTOSTART<span class="w"> </span>GROUPS<span class="w"> </span>IPV4<span class="w">    </span>IPV6<span class="w">    </span>UNPRIVILEGED
aur_helper<span class="w"> </span>RUNNING<span class="w"> </span><span class="m">0</span><span class="w">         </span>-<span class="w">      </span>omitted<span class="w"> </span>omitted<span class="w"> </span><span class="nb">false</span>
</code></pre></div>

<p>Just use the local ip address in the IPV4 column and you can ssh into your user
like so.</p>
<div class="codehilite"><pre><span></span><code>&gt;<span class="w"> </span>ssh<span class="w"> </span>build@10.0.3.1
</code></pre></div>

<h3 id="creating-the-build-user">Creating the build user</h3>
<p>A <code>build</code> user is to be created with <code>sudo</code> privileges that will be used to run
the builds.</p>
<p>First, create the user.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>useradd<span class="w"> </span>-m<span class="w"> </span>-s<span class="w"> </span>/usr/bin/bash<span class="w"> </span>build
</code></pre></div>

<p>Then add sudo privileges for the <code>build</code> user.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="nv">EDITOR</span><span class="o">=</span>nano<span class="w"> </span>visudo
</code></pre></div>

<p>Add the following line for sudo privileges for <code>build</code>.</p>
<div class="codehilite"><pre><span></span><code>build ALL=(ALL:ALL) NOPASSWD: ALL
</code></pre></div>

<p>If you prefer to have <code>build</code> use a password for sudo privielges, then use the
following instead.</p>
<div class="codehilite"><pre><span></span><code>build ALL=(ALL:ALL) ALL
</code></pre></div>

<p>And set <code>build</code>'s password.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>passwd<span class="w"> </span>build
</code></pre></div>

<p>Open a shell as <code>build</code> to check if it works.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>su<span class="w"> </span>-<span class="w"> </span>build
$<span class="w"> </span>sudo<span class="w"> </span>ls<span class="w"> </span>-a
</code></pre></div>

<p>At this point you should be able to ssh into <code>build</code>.</p>
<h2 id="creating-the-chroot">Creating the CHROOT</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Continue the following steps as the <code>build</code> user, not as <code>root</code>.</p>
</div>
<p>Use <code>/usr/bin/mkarchroot</code> to create a CHROOT at <code>/home/build/chroot/root</code>.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>mkdir<span class="w"> </span>/home/build/chroot
$<span class="w"> </span>mkarchroot<span class="w"> </span>/home/build/chroot/root<span class="w"> </span>base<span class="w"> </span>base-devel<span class="w"> </span>cmake<span class="w"> </span>ninja
</code></pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do NOT preinstall <code>ccache</code> or <code>sccache</code> in the CHROOT as it will be handled
by AnotherAURHelper.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>From now on, you must refer to the CHROOT as <code>/home/build/chroot</code> when
handling it in AnotherAURHelper, even if the actual chroot is inside of
<code>/home/build/chroot/root</code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default LXC ArchLinux container has <code>/etc/locale.conf</code> set to <code>C.UTF-8</code>.
You may have to change <a href="https://wiki.archlinux.org/title/Installation_guide#Localization">locale settings as in the installation guide on the
ArchWiki</a>.</p>
</div>
<h2 id="set-up-gnupg-for-signature-verifcation-and-package-signing">Set up GnuPG for Signature Verifcation and Package Signing</h2>
<h3 id="checking-gnupg">Checking GnuPG</h3>
<p>Create a directory at a location of your choosing, ideally inside of
<code>/home/build/</code>.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>mkdir<span class="w"> </span>/home/build/checking_gpg
$<span class="w"> </span>chmod<span class="w"> </span><span class="m">700</span><span class="w"> </span>/home/build/checking_gpg
$<span class="w"> </span><span class="nv">GNUPGHOME</span><span class="o">=</span>/home/build/checking_gpg<span class="w"> </span>gpg<span class="w"> </span>-k
</code></pre></div>

<p>Whenever a build fails due to missing gpg public keys, the key can be added to
this directory. Usually there should be a key file inside of the AUR pkg's
directory, but otherwise the fingerprint can be used to fetch it directly.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Load key from file</span>
$<span class="w"> </span><span class="nv">GNUPGHOME</span><span class="o">=</span>/home/build/checking_gpg<span class="w"> </span>gpg<span class="w"> </span>--import<span class="w"> </span>&lt;<span class="w"> </span>the_pub_key_file.pub
<span class="c1"># Load key via fingerprint</span>
$<span class="w"> </span><span class="nv">GNUPGHOME</span><span class="o">=</span>/home/build/checking_gpg<span class="w"> </span>gpg<span class="w"> </span>--recv-keys<span class="w"> </span>A_DEV_KEYS_FINGERPRINT
</code></pre></div>

<h3 id="signing-gnupg">Signing GnuPG</h3>
<p>A GnuPG public/private key pair will need to be generated. Only keys with
signature creation is necessary, so generate accordingly. Like the previous
GnuPG directory, this can be placed in <code>/home/build/</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you encounter errors, try using <code>--pinentry-mode loopback</code> as a flag to
pass to gpg. Otherwise, run the shell inside of a <code>tmux</code> session. This may
occur if you are accessing the <code>build</code> user through an attached shell
instead of <code>ssh</code>.</p>
</div>
<p>Also, be prepared to set up a password for this key.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Write the password down somewhere so you don't forget it! If you ever lose
this password, you will need to revoke the old key, re-generate a new key,
delete all package signatures, and re-sign all packages and the package
database. (We will cover revoking old keys when necessary, package
signatures, and the package database later.)</p>
</div>
<p>Follow the following to generate a GnuPG key for signatures only.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>mkdir<span class="w"> </span>/home/build/signing_gpg
$<span class="w"> </span>chmod<span class="w"> </span><span class="m">700</span><span class="w"> </span>/home/build/signing_gpg
$<span class="w"> </span><span class="nv">GNUPGHOME</span><span class="o">=</span>/home/build/signing_gpg<span class="w"> </span>gpg<span class="w"> </span>--pinentry-mode<span class="w"> </span>loopback<span class="w"> </span>--full-gen-key
gpg<span class="w"> </span><span class="o">(</span>GnuPG<span class="o">)</span><span class="w"> </span><span class="m">2</span>.4.7<span class="p">;</span><span class="w"> </span>Copyright<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="m">2024</span><span class="w"> </span>g10<span class="w"> </span>Code<span class="w"> </span>GmbH
This<span class="w"> </span>is<span class="w"> </span>free<span class="w"> </span>software:<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>free<span class="w"> </span>to<span class="w"> </span>change<span class="w"> </span>and<span class="w"> </span>redistribute<span class="w"> </span>it.
There<span class="w"> </span>is<span class="w"> </span>NO<span class="w"> </span>WARRANTY,<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>extent<span class="w"> </span>permitted<span class="w"> </span>by<span class="w"> </span>law.

gpg:<span class="w"> </span>keybox<span class="w"> </span><span class="s1">&#39;/home/build/signing_gpg/pubring.kbx&#39;</span><span class="w"> </span>created
Please<span class="w"> </span><span class="k">select</span><span class="w"> </span>what<span class="w"> </span>kind<span class="w"> </span>of<span class="w"> </span>key<span class="w"> </span>you<span class="w"> </span>want:
<span class="w">   </span><span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>RSA<span class="w"> </span>and<span class="w"> </span>RSA
<span class="w">   </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span>DSA<span class="w"> </span>and<span class="w"> </span>Elgamal
<span class="w">   </span><span class="o">(</span><span class="m">3</span><span class="o">)</span><span class="w"> </span>DSA<span class="w"> </span><span class="o">(</span>sign<span class="w"> </span>only<span class="o">)</span>
<span class="w">   </span><span class="o">(</span><span class="m">4</span><span class="o">)</span><span class="w"> </span>RSA<span class="w"> </span><span class="o">(</span>sign<span class="w"> </span>only<span class="o">)</span>
<span class="w">   </span><span class="o">(</span><span class="m">9</span><span class="o">)</span><span class="w"> </span>ECC<span class="w"> </span><span class="o">(</span>sign<span class="w"> </span>and<span class="w"> </span>encrypt<span class="o">)</span><span class="w"> </span>*default*
<span class="w">  </span><span class="o">(</span><span class="m">10</span><span class="o">)</span><span class="w"> </span>ECC<span class="w"> </span><span class="o">(</span>sign<span class="w"> </span>only<span class="o">)</span>
<span class="w">  </span><span class="o">(</span><span class="m">14</span><span class="o">)</span><span class="w"> </span>Existing<span class="w"> </span>key<span class="w"> </span>from<span class="w"> </span>card
Your<span class="w"> </span>selection?
$<span class="w"> </span><span class="m">10</span>
Please<span class="w"> </span><span class="k">select</span><span class="w"> </span>which<span class="w"> </span>elliptic<span class="w"> </span>curve<span class="w"> </span>you<span class="w"> </span>want:
<span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>Curve<span class="w"> </span><span class="m">25519</span><span class="w"> </span>*default*
<span class="o">(</span><span class="m">4</span><span class="o">)</span><span class="w"> </span>NIST<span class="w"> </span>P-384
<span class="o">(</span><span class="m">6</span><span class="o">)</span><span class="w"> </span>Brainpool<span class="w"> </span>P-256
Your<span class="w"> </span>selection?
$<span class="w"> </span><span class="m">1</span>
Please<span class="w"> </span>specify<span class="w"> </span>how<span class="w"> </span>long<span class="w"> </span>the<span class="w"> </span>key<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>valid.
<span class="w">         </span><span class="nv">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>expire
<span class="w">      </span>&lt;n&gt;<span class="w">  </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>days
<span class="w">      </span>&lt;n&gt;w<span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>weeks
<span class="w">      </span>&lt;n&gt;m<span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>months
<span class="w">      </span>&lt;n&gt;y<span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>years
Key<span class="w"> </span>is<span class="w"> </span>valid<span class="w"> </span><span class="k">for</span>?<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span>
$<span class="w"> </span><span class="m">0</span>
Key<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>expire<span class="w"> </span>at<span class="w"> </span>all
Is<span class="w"> </span>this<span class="w"> </span>correct?<span class="w"> </span><span class="o">(</span>y/N<span class="o">)</span>
$<span class="w"> </span>y

GnuPG<span class="w"> </span>needs<span class="w"> </span>to<span class="w"> </span>construct<span class="w"> </span>a<span class="w"> </span>user<span class="w"> </span>ID<span class="w"> </span>to<span class="w"> </span>identify<span class="w"> </span>your<span class="w"> </span>key.

Real<span class="w"> </span>name:
$<span class="w"> </span>My<span class="w"> </span>Name<span class="w"> </span><span class="o">(</span>AUR<span class="w"> </span>Helper<span class="w"> </span>Signing<span class="w"> </span>Key<span class="o">)</span>
Email<span class="w"> </span>address:
$<span class="w"> </span>my_email@example.com
Comment:
$<span class="w"> </span>Key<span class="w"> </span><span class="k">for</span><span class="w"> </span>AnotherAURHelper
You<span class="w"> </span>selected<span class="w"> </span>this<span class="w"> </span>USER-ID:
<span class="w">    </span><span class="s2">&quot;My Name (AUR Helper Signing Key) (Key for AnotherAURHelper) &lt;my_email@example.com&gt;&quot;</span>

Change<span class="w"> </span><span class="o">(</span>N<span class="o">)</span>ame,<span class="w"> </span><span class="o">(</span>C<span class="o">)</span>omment,<span class="w"> </span><span class="o">(</span>E<span class="o">)</span>mail<span class="w"> </span>or<span class="w"> </span><span class="o">(</span>O<span class="o">)</span>kay/<span class="o">(</span>Q<span class="o">)</span>uit?
$<span class="w"> </span>O
We<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>generate<span class="w"> </span>a<span class="w"> </span>lot<span class="w"> </span>of<span class="w"> </span>random<span class="w"> </span>bytes.<span class="w"> </span>It<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>good<span class="w"> </span>idea<span class="w"> </span>to<span class="w"> </span>perform
some<span class="w"> </span>other<span class="w"> </span>action<span class="w"> </span><span class="o">(</span><span class="nb">type</span><span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>keyboard,<span class="w"> </span>move<span class="w"> </span>the<span class="w"> </span>mouse,<span class="w"> </span>utilize<span class="w"> </span>the
disks<span class="o">)</span><span class="w"> </span>during<span class="w"> </span>the<span class="w"> </span>prime<span class="w"> </span>generation<span class="p">;</span><span class="w"> </span>this<span class="w"> </span>gives<span class="w"> </span>the<span class="w"> </span>random<span class="w"> </span>number
generator<span class="w"> </span>a<span class="w"> </span>better<span class="w"> </span>chance<span class="w"> </span>to<span class="w"> </span>gain<span class="w"> </span>enough<span class="w"> </span>entropy.
Enter<span class="w"> </span>passphrase:
$<span class="w"> </span>***********
gpg:<span class="w"> </span>/home/build/signing_gpg/trustdb.gpg:<span class="w"> </span>trustdb<span class="w"> </span>created
gpg:<span class="w"> </span>directory<span class="w"> </span><span class="s1">&#39;/home/build/signing_gpg/openpgp-revocs.d&#39;</span><span class="w"> </span>created
gpg:<span class="w"> </span>revocation<span class="w"> </span>certificate<span class="w"> </span>stored<span class="w"> </span>as<span class="w"> </span><span class="s1">&#39;/home/build/signing_gpg/openpgp-revocs.d/BFD86E817FA4B097A8636507A4FDFD431A0D481B.rev&#39;</span>
public<span class="w"> </span>and<span class="w"> </span>secret<span class="w"> </span>key<span class="w"> </span>created<span class="w"> </span>and<span class="w"> </span>signed.
pub<span class="w">   </span>ed25519<span class="w"> </span><span class="m">2025</span>-03-04<span class="w"> </span><span class="o">[</span>SC<span class="o">]</span>
<span class="w">      </span>BFD86E817FA4B097A8636507A4FDFD431A0D481B
uid<span class="w">                      </span>My<span class="w"> </span>Name<span class="w"> </span><span class="o">(</span>AUR<span class="w"> </span>Helper<span class="w"> </span>Signing<span class="w"> </span>Key<span class="o">)</span><span class="w"> </span><span class="o">(</span>Key<span class="w"> </span><span class="k">for</span><span class="w"> </span>AnotherAURHelper<span class="o">)</span><span class="w"> </span>&lt;my_email@example.com&gt;
</code></pre></div>

<p>Verify you inputed the password correctly:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>test_file<span class="w"> </span>&gt;<span class="w"> </span>test_file
$<span class="w"> </span><span class="nv">GNUPGHOME</span><span class="o">=</span>/home/build/signing_gpg<span class="w"> </span>gpg<span class="w"> </span>--pinentry-mode<span class="w"> </span>loopback<span class="w"> </span>--detach-sign<span class="w"> </span>test_file
Enter<span class="w"> </span>passphrase:
$<span class="w"> </span>***********
$<span class="w"> </span><span class="nv">GNUPGHOME</span><span class="o">=</span>/home/build/signing_gpg<span class="w"> </span>gpg<span class="w"> </span>--verify<span class="w"> </span>test_file.sig
gpg:<span class="w"> </span>assuming<span class="w"> </span>signed<span class="w"> </span>data<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s1">&#39;test_file&#39;</span>
gpg:<span class="w"> </span>Signature<span class="w"> </span>made<span class="w"> </span>Tue<span class="w"> </span>Mar<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">03</span>:59:43<span class="w"> </span><span class="m">2025</span><span class="w"> </span>UTC
gpg:<span class="w">                </span>using<span class="w"> </span>EDDSA<span class="w"> </span>key<span class="w"> </span>BFD86E817FA4B097A8636507A4FDFD431A0D481B
gpg:<span class="w"> </span>checking<span class="w"> </span>the<span class="w"> </span>trustdb
gpg:<span class="w"> </span>marginals<span class="w"> </span>needed:<span class="w"> </span><span class="m">3</span><span class="w">  </span>completes<span class="w"> </span>needed:<span class="w"> </span><span class="m">1</span><span class="w">  </span>trust<span class="w"> </span>model:<span class="w"> </span>pgp
gpg:<span class="w"> </span>depth:<span class="w"> </span><span class="m">0</span><span class="w">  </span>valid:<span class="w">   </span><span class="m">1</span><span class="w">  </span>signed:<span class="w">   </span><span class="m">0</span><span class="w">  </span>trust:<span class="w"> </span><span class="m">0</span>-,<span class="w"> </span>0q,<span class="w"> </span>0n,<span class="w"> </span>0m,<span class="w"> </span>0f,<span class="w"> </span>1u
gpg:<span class="w"> </span>Good<span class="w"> </span>signature<span class="w"> </span>from<span class="w"> </span><span class="s2">&quot;My Name (AUR Helper Signing Key) (Key for AnotherAURHelper) &lt;my_email@example.com&gt;&quot;</span><span class="w"> </span><span class="o">[</span>ultimate<span class="o">]</span>
<span class="c1"># cleanup</span>
$<span class="w"> </span>rm<span class="w"> </span>test_file<span class="w"> </span>test_file.sig
</code></pre></div>

<h2 id="set-up-output-dir-and-configuration">Set up Output Dir and Configuration</h2>
<p>Create an output directory for your built packages.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>mkdir<span class="w"> </span>/home/build/aur_pkgs
</code></pre></div>

<p>Set up a <code>/home/build/config.toml</code> file with config for AnotherAURHelper.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>config.toml</code> file can be named anything.</p>
</div>
<p>Refer to the <code>example_config.toml</code> file inside AnotherAURHelper's repo as a
reference.<br />
At this point, we will clone AnotherAURHelper.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Stephen-Seo/AnotherAURHelper.git
</code></pre></div>

<p>Your config should look like the following:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">########## MANDATORY VARIABLES</span>
<span class="n">chroot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/home/build/chroot&quot;</span>
<span class="c1"># Location to place built packages.</span>
<span class="n">pkg_out_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/home/build/aur_pkgs&quot;</span>
<span class="c1"># It is recommended to put the repo file in the &quot;pkg_out_dir&quot;.</span>
<span class="c1"># If the tar file doesn&#39;t already exist, it will be automatically created.</span>
<span class="n">repo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/home/build/aur_pkgs/MyRepo.db.tar&quot;</span>
<span class="c1"># Location to clone packages from AUR.</span>
<span class="n">clones_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/home/build/aur&quot;</span>
<span class="n">gpg_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/home/build/checking_gpg&quot;</span>
<span class="n">logs_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/home/build/logs&quot;</span>
<span class="n">signing_gpg_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/home/build/signing_gpg&quot;</span>
<span class="n">signing_gpg_key_fp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;BFD86E817FA4B097A8636507A4FDFD431A0D481B&quot;</span>
<span class="n">editor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/usr/bin/nano&quot;</span>
<span class="c1"># if true, all logs are prepended with current time in UTC</span>
<span class="n">is_timed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span>
<span class="c1"># if true, all output build logs are prepended with current time in UTC</span>
<span class="n">is_log_timed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span>
<span class="c1"># Default log_limit is 1 GiB</span>
<span class="n">log_limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1073741824</span>
<span class="c1"># If true, then make the build fail if the limit is reached</span>
<span class="n">error_on_limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span>
<span class="c1"># If true, timestamps are in localtime. If false, timestamps are UTC.</span>
<span class="n">datetime_in_local_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span>
<span class="c1"># If true, all builds will be done in a tmpfs. Recommended to have a lot of RAM and/or swap.</span>
<span class="n">tmpfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span>
<span class="c1"># If true, only packages to be built will be printed when USR1 is signaled.</span>
<span class="n">print_state_info_only_building_sigusr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span>
<span class="c1">########## END OF MANDATORY VARIABLES</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>repo = ...</code> option determines the name of the repository. If you want
to name it "MyCoolRepo", then it should be set as <code>repo = "/home/build/aur_pkgs/MyCoolRepo.db.tar"</code>.</p>
</div>
<p>Create some necessary directories.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>aur_pkgs
$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>aur
$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>logs
</code></pre></div>

<p>Create some necessary symlinks based on the previously set <code>repo = ...</code>.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>MyRepo.db.tar<span class="w"> </span>/home/build/aur_pkgs/MyRepo.db
$<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>MyRepo.files.tar<span class="w"> </span>/home/build/aur_pkgs/MyRepo.files
</code></pre></div>

<p>Here is a few packages you can add to your <code>config.toml</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="k">[[entry]]</span>
<span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;stdman&quot;</span>

<span class="k">[[entry]]</span>
<span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cpufetch-git&quot;</span>
</code></pre></div>

<h2 id="registering-the-repo-on-other-arch-systems">Registering the Repo on other Arch systems</h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Some commands/config should be used on in your LXC container and some on a
different ArchLinux system that will install the packages built by
AnotherAURHelper. Thus, be sure you are on the right system before inputting
commands as it may get confusing.</p>
</div>
<p>The following assumes that the AUR repo's name is <code>MyRepo</code> as indicated in the
previous config.</p>
<p>Add the following to your <code>/etc/pacman.conf</code> on an ArchLinux system that will
install the built AUR packages you build.</p>
<div class="codehilite"><pre><span></span><code><span class="k">[MyRepo]</span>
<span class="na">SigLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Required TrustedOnly</span>
<span class="na">Server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">file:///home/user/aur_pkgs</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This config assumes use of <code>sshfs</code> or <code>rsync</code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to use <code>nginx</code> (or others) to host the directory to use as a
repo accessible over http/https. This is a little more involved but is
possible. Accessing such on other systems may set the <code>Server = ...</code> line
in the <code>/etc/pacman.conf</code> to a url like
<code>Server = https://example.com/aur_pkgs</code>.</p>
</div>
<p>We're not done yet, as the other ArchLinux system needs to get the public key
of the AUR Helper signing key to verify the packages built and signed by
AnotherAURHelper.</p>
<p>Export the public key of your GnuPG signing key from your LXC instance.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="nv">GNUPGHOME</span><span class="o">=</span>/home/build/signing_gpg<span class="w"> </span>gpg<span class="w"> </span>--export<span class="w"> </span>&gt;<span class="w"> </span>signing_key.pub
</code></pre></div>

<p>Use <code>scp</code>, <code>sftp</code>, or <code>sshfs</code> to get this public key out of the container. Use
<code>pacman-key</code> on the other ArchLinux system to import and locally sign the
public key to trust it.</p>
<div class="codehilite"><pre><span></span><code>&gt;<span class="w"> </span>sudo<span class="w"> </span>pacman-key<span class="w"> </span>-a<span class="w"> </span>signing_key.pub
</code></pre></div>

<p>Check that the imported key is the only key listed when querying for it.</p>
<div class="codehilite"><pre><span></span><code>&gt;<span class="w"> </span>sudo<span class="w"> </span>pacman-key<span class="w"> </span>--finger<span class="w"> </span><span class="s1">&#39;AUR Helper Signing Key&#39;</span>
pub<span class="w">   </span>ed25519<span class="w"> </span><span class="m">2025</span>-03-04<span class="w"> </span><span class="o">[</span>SC<span class="o">]</span>
<span class="w">      </span>BFD8<span class="w"> </span>6E81<span class="w"> </span>7FA4<span class="w"> </span>B097<span class="w"> </span>A863<span class="w">  </span><span class="m">6507</span><span class="w"> </span>A4FD<span class="w"> </span>FD43<span class="w"> </span>1A0D<span class="w"> </span>481B
uid<span class="w">           </span><span class="o">[</span><span class="w"> </span>unknown<span class="o">]</span><span class="w"> </span>My<span class="w"> </span>Name<span class="w"> </span><span class="o">(</span>AUR<span class="w"> </span>Helper<span class="w"> </span>Signing<span class="w"> </span>Key<span class="o">)</span><span class="w"> </span><span class="o">(</span>Key<span class="w"> </span><span class="k">for</span><span class="w"> </span>AnotherAURHelper<span class="o">)</span><span class="w"> </span>&lt;my_email@example.com&gt;
</code></pre></div>

<p>If there is only one key listed, then you can use the <code>AUR Helper Signing Key</code>
string to specify the correct key to sign. (Signing another key in GnuPG means
that you trust it.) If more than one key is listed, you will have to adjust the
string passed to <code>pacman-key --finger ...</code> until only the key you want to sign
is shown.</p>
<p>Once you've determined the string that specifies the key you created and want
to sign, sign it.</p>
<div class="codehilite"><pre><span></span><code>&gt;<span class="w"> </span>sudo<span class="w"> </span>pacman-key<span class="w"> </span>--lsign-key<span class="w"> </span><span class="s1">&#39;AUR Helper Signing Key&#39;</span>
</code></pre></div>

<p>Once this is done, the ArchLinux system will now trust packages signed by your
signing key. If you want to revoke such a key, you can delete it from your
pacman's keyring.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be careful with <code>pacman-key</code>'s delete command, as you might accidentally
delete keys you don't mean to delete. If such a thing happens, you may have
to <a href="https://wiki.archlinux.org/title/Pacman/Package_signing#Resetting_all_the_keys">regenerate your ArchLinux installation's pacman keyring</a>.</p>
</div>
<p>Use the following command to delete a key from your ArchLinux system's keyring.</p>
<div class="codehilite"><pre><span></span><code>&gt;<span class="w"> </span>sudo<span class="w"> </span>pacman-key<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;AUR Helper Signing Key&#39;</span>
</code></pre></div>

<h2 id="testing">Testing</h2>
<p>The build process will typically involve running the following.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>./AnotherAURHelper/update.py<span class="w"> </span>--config<span class="w"> </span>/home/build/config.toml
</code></pre></div>

<p>Just follow the steps, and by the end of it, it should build your packages,
sign them, and place them in the directory specified in your <code>config.toml</code>.</p>
<h2 id="serving-the-packages">Serving the Packages</h2>
<p>As mentioned earlier, the contents of your <code>/home/build/aur_pkgs</code> directory can
be served with <code>nginx</code> or others. The directory can be copied from your LXC
container to elsewhere with <code>ssh</code> (<code>sshfs</code> maybe) or even <code>rsync</code>.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
