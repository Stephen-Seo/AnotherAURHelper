<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Setup with LXC - Docs for AnotherAURHelper</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link href="../monokai.css" rel="stylesheet"> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Docs for AnotherAURHelper</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Setup with LXC</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#setting-up-anotheraurhelper-with-lxc" class="nav-link">Setting up AnotherAURHelper with LXC</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#privileged-containers" class="nav-link">Privileged Containers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#lxc-container-setup" class="nav-link">LXC Container Setup</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#creating-the-chroot" class="nav-link">Creating the CHROOT</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#set-up-gnupg-for-signature-verifcation-and-package-signing" class="nav-link">Set up GnuPG for Signature Verifcation and Package Signing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#set-up-output-dir-and-configuration" class="nav-link">Set up Output Dir and Configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#registering-the-repo-on-other-arch-systems" class="nav-link">Registering the Repo on other Arch systems</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#testing" class="nav-link">Testing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#serving-the-packages" class="nav-link">Serving the Packages</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="setting-up-anotheraurhelper-with-lxc">Setting up AnotherAURHelper with LXC</h1>
<p>It is recommended to use AnotherAURHelper with a container as a safety net due
to the fact that <code>makechrootpkg</code> directly sources/parses PKGBUILDs.</p>
<p>The following assumes you already have LXC installed. If not, <a href="https://wiki.archlinux.org/title/Linux_Containers#Setup">follow the
ArchWiki</a> until you
can get an arbitrary container up and running.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following code blocks will have different prefixes. <code>&gt;</code> is used to
specify commands run on an ArchLinux installation, and <code>$</code> is used to
specify commands run inside of the LXC container.</p>
</div>
<h2 id="privileged-containers">Privileged Containers</h2>
<p>AnotherAURHelper requires to be run in a privileged container because it uses
a chroot. If your LXC is already configured for unprivileged containers, you can
create a privileged container by commenting out the config for an unprivileged
container and creating a container, and uncommenting after the container has
been created to allow future containers to be created as unprivileged.</p>
<div class="codehilite"><pre><code># /etc/lxc/default.conf
<span class="c">#lxc.idmap = u 0 100000 65536
#lxc.idmap = g 0 100000 65536</span></code></pre></div>

<h2 id="lxc-container-setup">LXC Container Setup</h2>
<p>Create the container like the following on your host system.</p>
<div class="codehilite"><pre><code><span class="cmd">> sudo lxc-create -n aur_helper -t download</span>
Downloading the image index

---
DIST             RELEASE     ARCH   VARIANT  BUILD
---
...
archlinux        current     amd64  default  20250303_05:33
archlinux        current     arm64  default  20250303_05:49
...
---

Distribution:
<span class="cmd">> archlinux</span>
Release:
<span class="cmd">> current</span>
Architecture:
<span class="cmd">> amd64</span>

The cached copy has expired, re-downloading...
Downloading the image index
Downloading the rootfs
Downloading the metadata
The image cache is now ready
Unpacking the rootfs

---
You just created an Archlinux  x86_64 (20250303_05:33) container.
</code></pre></div>

<p>Start the container.</p>
<div class="codehilite"><pre><code><span class="cmd">> sudo lxc-start -n aur_helper -s lxc.apparmor.allow_nesting=1 -s lxc.apparmor.profile=generated</span></code></pre></div>

<p>Attach to a shell inside the container.</p>
<div class="codehilite"><pre><code><span class="cmd">> sudo lxc-attach -n aur_helper</span></code></pre></div>

<h3 id="getting-required-packages">Getting Required Packages</h3>
<p>Update your <a href="https://wiki.archlinux.org/title/Mirrors">mirror-list</a> in the
container and update.</p>
<div class="codehilite"><pre><code><span class="lxc">$ pacman -Syu</span></code></pre></div>

<p><code>base-devel</code>, <code>devtools</code>, <code>python-toml</code>, and <code>ccache</code> is required.</p>
<div class="codehilite"><pre><code><span class="lxc">$ pacman -S base-devel devtools python-toml ccache</span></code></pre></div>

<p>You may need to grab an editor like <code>vim</code>, <code>emacs</code>, or <code>nano</code>.</p>
<div class="codehilite"><pre><code><span class="lxc">$ pacman -S vim emacs nano</span></code></pre></div>

<p>If your filesystem is using <code>btrfs</code>, you will need to install <code>btrfs-progs</code>.</p>
<div class="codehilite"><pre><code><span class="lxc">$ pacman -S btrfs-progs</span></code></pre></div>

<h3 id="setting-up-ssh-for-the-container">Setting up SSH for the Container</h3>
<p>This is pretty straightforward, but for those unfamiliar with ssh, heres a quick
setup guide.</p>
<p>First, install <code>openssh</code>.</p>
<div class="codehilite"><pre><code><span class="lxc">$ pacman -S openssh</span></code></pre></div>

<p>Enable and start sshd.</p>
<div class="codehilite"><pre><code><span class="lxc">$ systemctl enable --now sshd</span></code></pre></div>

<p>After setting up the user in the following section, you can use ssh to log in to
the user.</p>
<p>You can fetch the local ip address of the running container with the following.</p>
<div class="codehilite"><pre><code><span class="cmd">> sudo lxc-ls -f</span>
NAME       STATE   AUTOSTART GROUPS IPV4    IPV6    UNPRIVILEGED
aur_helper RUNNING 0         -      omitted omitted false</code></pre></div>

<p>Just use the local ip address in the IPV4 column and you can ssh into your user
like so.</p>
<div class="codehilite"><pre><code><span class="cmd">> ssh build@10.0.3.1</span></code></pre></div>

<h3 id="creating-the-build-user">Creating the build user</h3>
<p>A <code>build</code> user is to be created with <code>sudo</code> privileges that will be used to run
the builds.</p>
<p>First, create the user.</p>
<div class="codehilite"><pre><code><span class="lxc">$ useradd -m -s /usr/bin/bash build</span></code></pre></div>

<p>Then add sudo privileges for the <code>build</code> user.</p>
<div class="codehilite"><pre><code><span class="lxc">$ EDITOR=nano visudo</span></code></pre></div>

<p>Add the following line for sudo privileges for <code>build</code>.</p>
<div class="codehilite"><pre><code><span class="txt">build ALL=(ALL:ALL) NOPASSWD: ALL</span></code></pre></div>

<p>If you prefer to have <code>build</code> use a password for sudo privielges, then use the
following instead.</p>
<div class="codehilite"><pre><code><span class="txt">build ALL=(ALL:ALL) ALL</span></code></pre></div>

<p>And set <code>build</code>'s password.</p>
<div class="codehilite"><pre><code><span class="lxc">$ passwd build</span></code></pre></div>

<p>Open a shell as <code>build</code> to check if it works.</p>
<div class="codehilite"><pre><code><span class="lxc">$ su - build
$ sudo ls -a</span></code></pre></div>

<p>At this point you should be able to ssh into <code>build</code>.</p>
<h2 id="creating-the-chroot">Creating the CHROOT</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Continue the following steps as the <code>build</code> user, not as <code>root</code>.</p>
</div>
<p>Use <code>/usr/bin/mkarchroot</code> to create a CHROOT at <code>/home/build/chroot/root</code>.</p>
<div class="codehilite"><pre><code><span class="lxc">$ mkdir /home/build/chroot
$ mkarchroot /home/build/chroot/root base base-devel cmake ninja</span></code></pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do NOT preinstall <code>ccache</code> or <code>sccache</code> in the CHROOT as it will be handled
by AnotherAURHelper.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>From now on, you must refer to the CHROOT as <code>/home/build/chroot</code> when
handling it in AnotherAURHelper, even if the actual chroot is inside of
<code>/home/build/chroot/root</code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default LXC ArchLinux container has <code>/etc/locale.conf</code> set to <code>C.UTF-8</code>.
You may have to change <a href="https://wiki.archlinux.org/title/Installation_guide#Localization">locale settings as in the installation guide on the
ArchWiki</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You are able to run commands in the CHROOT:<br />
<div class="codehilite"><pre><code><span class="lxc">$ arch-nspawn /home/build/chroot/root pacman -S cmake</span></code></pre></div><br />
You may do this to also set proper locale information in the CHROOT.</p>
</div>
<h2 id="set-up-gnupg-for-signature-verifcation-and-package-signing">Set up GnuPG for Signature Verifcation and Package Signing</h2>
<h3 id="checking-gnupg">Checking GnuPG</h3>
<p>Create a directory at a location of your choosing, ideally inside of
<code>/home/build/</code>.</p>
<div class="codehilite"><pre><code><span class="lxc">$ mkdir /home/build/checking_gpg
$ chmod 700 /home/build/checking_gpg
$ GNUPGHOME=/home/build/checking_gpg gpg -k</span></code></pre></div>

<p>Whenever a build fails due to missing gpg public keys, the key can be added to
this directory. Usually there should be a key file inside of the AUR pkg's
directory, but otherwise the fingerprint can be used to fetch it directly.</p>
<div class="codehilite"><pre><code><span class="c"># Load key from file</span>
<span class="lxc">$ GNUPGHOME=/home/build/checking_gpg gpg --import < the_pub_key_file.pub</span>
<span class="c"># Fetch key via fingerprint from a keyserver</span>
<span class="lxc">$ GNUPGHOME=/home/build/checking_gpg gpg --recv-keys A_DEV_KEYS_FINGERPRINT</span></code></pre></div>

<h3 id="signing-gnupg">Signing GnuPG</h3>
<p>A GnuPG public/private key pair will need to be generated. Only keys with
signature creation is necessary, so generate accordingly. Like the previous
GnuPG directory, this can be placed in <code>/home/build/</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you encounter errors, try using <code>--pinentry-mode loopback</code> as a flag to
pass to gpg. Otherwise, run the shell inside of a <code>tmux</code> session. This may
occur if you are accessing the <code>build</code> user through an attached shell
instead of <code>ssh</code>.</p>
</div>
<p>Also, be prepared to set up a password for this key.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Write the password down somewhere so you don't forget it! If you ever lose
this password, you will need to revoke the old key, re-generate a new key,
delete all package signatures, and re-sign all packages and the package
database. (We will cover revoking old keys when necessary, package
signatures, and the package database later.)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It may be beneficial to use a long password for this key instead of a short
memorable one, as a malicious PKGBUILD might attempt to access it if the
PKGBUILD hasn't been properly vetted first.</p>
</div>
<p>Follow the following to generate a GnuPG key for signatures only.</p>
<div class="codehilite"><pre><code><span class="lxc">$ mkdir /home/build/signing_gpg
$ chmod 700 /home/build/signing_gpg
$ GNUPGHOME=/home/build/signing_gpg gpg --pinentry-mode loopback --full-gen-key</span>
gpg (GnuPG) 2.4.7; Copyright (C) 2024 g10 Code GmbH
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

gpg: keybox '/home/build/signing_gpg/pubring.kbx' created
Please select what kind of key you want:
   (1) RSA and RSA
   (2) DSA and Elgamal
   (3) DSA (sign only)
   (4) RSA (sign only)
   (9) ECC (sign and encrypt) *default*
  (10) ECC (sign only)
  (14) Existing key from card
Your selection?
<span class="lxc">$ 10</span>
Please select which elliptic curve you want:
(1) Curve 25519 *default*
(4) NIST P-384
(6) Brainpool P-256
Your selection?
<span class="lxc">$ 1</span>
Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for? (0)
<span class="lxc">$ 0</span>
Key does not expire at all
Is this correct? (y/N)
<span class="lxc">$ y</span>

GnuPG needs to construct a user ID to identify your key.

Real name:
<span class="lxc">$ My Name (AUR Helper Signing Key)</span>
Email address:
<span class="lxc">$ my_email@example.com</span>
Comment:
<span class="lxc">$ Key for AnotherAURHelper</span>
You selected this USER-ID:
    "My Name (AUR Helper Signing Key) (Key for AnotherAURHelper) &lt;my_email@example.com&gt;"

Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit?
<span class="lxc">$ O</span>
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
Enter passphrase:
<span class="lxc">$ ***********</span>
gpg: /home/build/signing_gpg/trustdb.gpg: trustdb created
gpg: directory '/home/build/signing_gpg/openpgp-revocs.d' created
gpg: revocation certificate stored as '/home/build/signing_gpg/openpgp-revocs.d/BFD86E817FA4B097A8636507A4FDFD431A0D481B.rev'
public and secret key created and signed.
pub   ed25519 2025-03-04 [SC]
      BFD86E817FA4B097A8636507A4FDFD431A0D481B
uid                      My Name (AUR Helper Signing Key) (Key for AnotherAURHelper) &lt;my_email@example.com&gt;</code></pre></div>

<p>Verify you inputed the password correctly:</p>
<div class="codehilite"><pre><code><span class="lxc">$ echo test_file > test_file
$ GNUPGHOME=/home/build/signing_gpg gpg --pinentry-mode loopback --detach-sign test_file</span>
Enter passphrase:
<span class="lxc">$ ***********
$ GNUPGHOME=/home/build/signing_gpg gpg --verify test_file.sig</span>
gpg: assuming signed data in 'test_file'
gpg: Signature made Tue Mar  4 03:59:43 2025 UTC
gpg:                using EDDSA key BFD86E817FA4B097A8636507A4FDFD431A0D481B
gpg: checking the trustdb
gpg: marginals needed: 3  completes needed: 1  trust model: pgp
gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
gpg: Good signature from "My Name (AUR Helper Signing Key) (Key for AnotherAURHelper) &lt;my_email@example.com&gt;" [ultimate]
<span class="c"># cleanup</span>
<span class="lxc">$ rm test_file test_file.sig</span></code></pre></div>

<h2 id="set-up-output-dir-and-configuration">Set up Output Dir and Configuration</h2>
<p>Create an output directory for your built packages.</p>
<div class="codehilite"><pre><code><span class="lxc">$ mkdir /home/build/aur_pkgs</span></code></pre></div>

<p>Set up a <code>/home/build/config.toml</code> file with config for AnotherAURHelper.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>config.toml</code> file can be named anything.</p>
</div>
<p>Refer to the <code>example_config.toml</code> file inside AnotherAURHelper's repo as a
reference.<br />
At this point, we will clone AnotherAURHelper.</p>
<div class="codehilite"><pre><code><span class="lxc">$ git clone https://github.com/Stephen-Seo/AnotherAURHelper.git</span></code></pre></div>

<p>Your config should look like the following:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">########## MANDATORY VARIABLES</span>
<span class="n">chroot</span> <span class="o">=</span> <span class="s2">&quot;/home/build/chroot&quot;</span>
<span class="c1"># Location to place built packages.</span>
<span class="n">pkg_out_dir</span> <span class="o">=</span> <span class="s2">&quot;/home/build/aur_pkgs&quot;</span>
<span class="c1"># It is recommended to put the repo file in the &quot;pkg_out_dir&quot;.</span>
<span class="c1"># If the tar file doesn&#39;t already exist, it will be automatically created.</span>
<span class="n">repo</span> <span class="o">=</span> <span class="s2">&quot;/home/build/aur_pkgs/MyRepo.db.tar&quot;</span>
<span class="c1"># Location to clone packages from AUR.</span>
<span class="n">clones_dir</span> <span class="o">=</span> <span class="s2">&quot;/home/build/aur&quot;</span>
<span class="n">gpg_dir</span> <span class="o">=</span> <span class="s2">&quot;/home/build/checking_gpg&quot;</span>
<span class="n">logs_dir</span> <span class="o">=</span> <span class="s2">&quot;/home/build/logs&quot;</span>
<span class="n">signing_gpg_dir</span> <span class="o">=</span> <span class="s2">&quot;/home/build/signing_gpg&quot;</span>
<span class="n">signing_gpg_key_fp</span> <span class="o">=</span> <span class="s2">&quot;BFD86E817FA4B097A8636507A4FDFD431A0D481B&quot;</span>
<span class="n">editor</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/nano&quot;</span>
<span class="c1"># if true, all logs are prepended with current time in UTC</span>
<span class="n">is_timed</span> <span class="o">=</span> <span class="n">true</span>
<span class="c1"># if true, all output build logs are prepended with current time in UTC</span>
<span class="n">is_log_timed</span> <span class="o">=</span> <span class="n">true</span>
<span class="c1"># Default log_limit is 1 GiB</span>
<span class="n">log_limit</span> <span class="o">=</span> <span class="mi">1073741824</span>
<span class="c1"># If true, then make the build fail if the limit is reached</span>
<span class="n">error_on_limit</span> <span class="o">=</span> <span class="n">true</span>
<span class="c1"># If true, timestamps are in localtime. If false, timestamps are UTC.</span>
<span class="n">datetime_in_local_time</span> <span class="o">=</span> <span class="n">true</span>
<span class="c1"># If true, all builds will be done in a tmpfs. Recommended to have a lot of RAM and/or swap.</span>
<span class="n">tmpfs</span> <span class="o">=</span> <span class="n">false</span>
<span class="c1"># If true, only packages to be built will be printed when USR1 is signaled.</span>
<span class="n">print_state_info_only_building_sigusr1</span> <span class="o">=</span> <span class="n">true</span>
<span class="c1">########## END OF MANDATORY VARIABLES</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>repo = ...</code> option determines the name of the repository. If you want
to name it "MyCoolRepo", then it should be set as <code>repo = "/home/build/aur_pkgs/MyCoolRepo.db.tar"</code>.</p>
</div>
<p>Create some necessary directories.</p>
<div class="codehilite"><pre><code><span class="lxc">$ mkdir -p aur_pkgs
$ mkdir -p aur
$ mkdir -p logs</span></code></pre></div>

<p>Create some necessary symlinks based on the previously set <code>repo = ...</code>.</p>
<div class="codehilite"><pre><code><span class="lxc">$ ln -s MyRepo.db.tar /home/build/aur_pkgs/MyRepo.db
$ ln -s MyRepo.files.tar /home/build/aur_pkgs/MyRepo.files</span></code></pre></div>

<p>Here is a few packages you can add to your <code>config.toml</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="k">[[entry]]</span>
<span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;stdman&quot;</span>

<span class="k">[[entry]]</span>
<span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cpufetch-git&quot;</span>
</code></pre></div>

<h2 id="registering-the-repo-on-other-arch-systems">Registering the Repo on other Arch systems</h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Some commands/config should be used on in your LXC container and some on a
different ArchLinux system that will install the packages built by
AnotherAURHelper. Thus, be sure you are on the right system before inputting
commands as it may get confusing.</p>
</div>
<p>The following assumes that the AUR repo's name is <code>MyRepo</code> as indicated in the
previous config.</p>
<p>Add the following to your <code>/etc/pacman.conf</code> on an ArchLinux system that will
install the built AUR packages you build.</p>
<div class="codehilite"><pre><span></span><code><span class="k">[MyRepo]</span>
<span class="na">SigLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Required TrustedOnly</span>
<span class="na">Server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">file:///home/user/aur_pkgs</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This config assumes use of <code>sshfs</code> or <code>rsync</code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to use <code>nginx</code> (or others) to host the directory to use as a
repo accessible over http/https. This is a little more involved but is
possible. Accessing such on other systems may set the <code>Server = ...</code> line
in the <code>/etc/pacman.conf</code> to a url like
<code>Server = https://example.com/aur_pkgs</code>.</p>
</div>
<p>We're not done yet, as the other ArchLinux system needs to get the public key
of the AUR Helper signing key to verify the packages built and signed by
AnotherAURHelper.</p>
<p>Export the public key of your GnuPG signing key from your LXC instance.</p>
<div class="codehilite"><pre><code><span class="lxc">$ GNUPGHOME=/home/build/signing_gpg gpg --export > signing_key.pub</span></code></pre></div>

<p>Use <code>scp</code>, <code>sftp</code>, or <code>sshfs</code> to get this public key out of the container. Use
<code>pacman-key</code> on the other ArchLinux system to import and locally sign the
public key to trust it.</p>
<div class="codehilite"><pre><code><span class="cmd">> sudo pacman-key -a signing_key.pub</span></code></pre></div>

<p>Check that the imported key is the only key listed when querying for it.</p>
<div class="codehilite"><pre><code><span class="cmd">> sudo pacman-key --finger 'AUR Helper Signing Key'</span>
pub   ed25519 2025-03-04 [SC]
      BFD8 6E81 7FA4 B097 A863  6507 A4FD FD43 1A0D 481B
uid           [ unknown] My Name (AUR Helper Signing Key) (Key for AnotherAURHelper) &lt;my_email@example.com&gt;</code></pre></div>

<p>If there is only one key listed, then you can use the <code>AUR Helper Signing Key</code>
string to specify the correct key to sign. (Signing another key in GnuPG means
that you trust it.) If more than one key is listed, you will have to adjust the
string passed to <code>pacman-key --finger ...</code> until only the key you want to sign
is shown.</p>
<p>Once you've determined the string that specifies the key you created and want
to sign, sign it.</p>
<div class="codehilite"><pre><code><span class="cmd">> sudo pacman-key --lsign-key 'AUR Helper Signing Key'</span></code></pre></div>

<p>Once this is done, the ArchLinux system will now trust packages signed by your
signing key. If you want to revoke such a key, you can delete it from your
pacman's keyring.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be careful with <code>pacman-key</code>'s delete command, as you might accidentally
delete keys you don't mean to delete. If such a thing happens, you may have
to <a href="https://wiki.archlinux.org/title/Pacman/Package_signing#Resetting_all_the_keys">regenerate your ArchLinux installation's pacman keyring</a>.</p>
</div>
<p>Use the following command to delete a key from your ArchLinux system's keyring.</p>
<div class="codehilite"><pre><code><span class="cmd">> sudo pacman-key -d 'AUR Helper Signing Key'</span></code></pre></div>

<h2 id="testing">Testing</h2>
<p>The build process will typically involve running the following.</p>
<div class="codehilite"><pre><code><span class="lxc">$ ./AnotherAURHelper/update.py --config /home/build/config.toml</span></code></pre></div>

<p>Just follow the steps, and by the end of it, it should build your packages,
sign them, and place them in the directory specified in your <code>config.toml</code>.</p>
<h2 id="serving-the-packages">Serving the Packages</h2>
<p>As mentioned earlier, the contents of your <code>/home/build/aur_pkgs</code> directory can
be served with <code>nginx</code> or others. The directory can be copied from your LXC
container to elsewhere with <code>ssh</code> (<code>sshfs</code> maybe) or even <code>rsync</code>.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
